<!DOCTYPE html>
<html lang="en" color-mode="user">
  <head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="https://unpkg.com/mvp.css@1.12/mvp.css" />
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
    <title>Spotify Bot</title>
  </head>
  <body>
    <header>
      <img
        src="https://media3.giphy.com/media/y4PQTcLTYJwOI/giphy.gif"
        alt="Snoopy Dancing"
      />
      <h1>ðŸŽ‰ Successfully logged into Spotify ðŸŽ‰</h1>
      <h2>You may close this page.</h2>
      <p>
        For more information please refer to
        <a
          href="https://github.com/hwhang0917/spotify-bot#readme"
          target="_blank"
          >README</a
        >
      </p>
    </header>
    <main>
      <section id="current"></section>
    </main>
    <footer>
      <hr />
      <p>
        <small
          ><a href="https://github.com/hwhang0917" target="_blank"
            >hwhang0917</a
          >
          &copy; 2023 Spotify Bot</small
        >
        <small
          >&centerdot; Styled With
          <a href="https://andybrewer.github.io/mvp/" target="_blank"
            >MVP.CSS</a
          ></small
        >
      </p>
    </footer>
    <script>
      window.history.pushState({}, document.title, window.location.pathname);
      const currentSection = document.getElementById('current');

      const createCurrentlyPlayingCard = async () => {
        try {
          const res = await fetch('/spotify/current');
          const data = await res.json();
          if (!data) return;

          currentSection.innerHTML = `
            <aside>
              <p>Current Song</p>
              <figure>
                <img width="150" height="150"
                src="${data.coverImageUrl}" /
                >
              </figure>
              <h3>
                ${data.name}
                ${data.isPlaying ? '<sup>playing</sup>' : ''}
              <p><small>By ${data.artists}</small></p>
            </aside>`;
        } catch (err) {
          console.error(err);
        }
      };

      createCurrentlyPlayingCard();
    </script>
  </body>
</html>
